/**
 * [TOTAL RECONSTRUCTION] PNA Company Main Landing Page
 * [Architecture] Strategic Section Hierarchy for B2B Tech Agency
 * [Design] High-End, Rhythmic, Data-Driven
 * [GEO] SEO-Optimized with JSON-LD
 */

import type { Metadata } from 'next';
import dynamic from 'next/dynamic';
import { HeroSectionFinal } from '@/components/landing/HeroSectionFinal';
import { ProblemsSection } from '@/components/landing/ProblemsSection';
import { getAllPosts } from '@/lib/api';

// Performance: ?? ??? ?? ???? lazy load
const AwardMetricsUnified = dynamic(() => import('@/components/landing/AwardMetricsUnified').then(mod => mod.AwardMetricsUnified));
const ServicesAlternate = dynamic(() => import('@/components/landing/ServicesAlternate').then(mod => mod.ServicesAlternate));
const PhilosophyList = dynamic(() => import('@/components/landing/PhilosophyList').then(mod => mod.PhilosophyList));
const CEOSection = dynamic(() => import('@/components/landing/CEOSection').then(mod => mod.CEOSection));
const InsightsSection = dynamic(() => import('@/components/landing/InsightsSection').then(mod => mod.InsightsSection));
const FAQSection = dynamic(() => import('@/components/landing/FAQSection').then(mod => mod.FAQSection));
const CTASection = dynamic(() => import('@/components/landing/CTASection').then(mod => mod.CTASection));

// ============================================
// [GEO] JSON-LD Structured Data
// ============================================
function generateJsonLd() {
  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'https://pnamarketing.co.kr';
  
  // [Security] env.ts?? ?? ?? - env ??? ?? ??
  const contactEmail = process.env.NEXT_PUBLIC_CONTACT_EMAIL!; // Non-null assertion (env.ts ???)
  
  return {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": `${baseUrl}/#organization`,
        "name": "???????",
        "alternateName": "PNA Company",
        "url": baseUrl,
        "logo": {
          "@type": "ImageObject",
          "url": `${baseUrl}/logo.png`,
        },
        "description": "??? ?? ?? ??? ?? - Google Ads, SEO, GEO ???? ROI 200% ??",
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+82-70-7733-7905",
          "email": contactEmail,
          "contactType": "Customer Service",
          "areaServed": "KR",
          "availableLanguage": ["Korean"]
        },
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "???195, SK??? ??? 2? 2120?",
          "addressLocality": "????",
          "addressRegion": "???",
          "addressCountry": "KR"
        },
      },
      {
        "@type": "WebSite",
        "@id": `${baseUrl}/#website`,
        "url": baseUrl,
        "name": "???????",
        "publisher": {
          "@id": `${baseUrl}/#organization`
        },
      },
      {
        "@type": "ProfessionalService",
        "@id": `${baseUrl}/#service`,
        "name": "Google Ads ?? ?? ???",
        "provider": {
          "@id": `${baseUrl}/#organization`
        },
        "areaServed": "KR",
        "serviceType": ["Google Ads", "SEO", "GEO", "WordPress", "Performance Marketing"],
      },
    ]
  };
}

// ============================================
// [GEO] Dynamic Metadata
// ============================================
export const metadata: Metadata = {
  title: '?? ?? ??? ??????? | TOP 1%? ???? ?? ???',
  description: '15? ?? ???? ??? ?? ?? ???. ROAS 500%? ???? ??? ?? ?? ??, SEO/GEO ???, ????? ?? ??. ???? ??? ??? ?????.',
  keywords: ['????', 'Google Ads', '?? ?? ??', 'SEO', 'GEO', '???? ???', 'GA4', '??? ??', 'Google TOP 100'],
  openGraph: {
    title: '?? ?? ??? ??????? | TOP 1%? ???? ??',
    description: '15? ?? ???? ??? ?? ?? ??? | ROAS 500% ??',
    type: 'website',
    locale: 'ko_KR',
    url: 'https://pnamarketing.co.kr',
    siteName: '???????',
    images: [
      {
        url: '/opengraph-image.png',
        width: 1200,
        height: 630,
        alt: '??????? - ?? ?? ??? | ?? ROAS 500% ??',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: '??????? - ?? ?? ???',
    description: 'Google ?? ??? | ?? ROAS 500% ??',
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
};

// ============================================
// [MAIN] Homepage - Strategic Layout
// ============================================
export default async function HomePage() {
  const jsonLd = generateJsonLd();
  
  // Fetch latest posts from WordPress
  let posts = await getAllPosts();

  return (
    <>
      {/* [GEO] JSON-LD Structured Data */}
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />

      {/* ?? Strategic Content Hierarchy */}
      <main className="relative">
        {/* Sticky Container - Limits sticky effect scope */}
        <div className="relative" style={{ height: '200vh' }}>
          {/* ???????????????????????????????????????????????????????????? */}
          {/* SECTION 1: HERO - Performance Architecture                    */}
          {/* ???????????????????????????????????????????????????????????? */}
          <HeroSectionFinal />
        </div>

        {/* Content Container - Overlays hero */}
        <div className="relative -mt-[100vh]">
          
          {/* ???????????????????????????????????????????????????????????? */}
          {/* SECTION 2: PROBLEMS - Structural Issues (Sticky Title)        */}
          {/* ???????????????????????????????????????????????????????????? */}
          <ProblemsSection />

          {/* ???????????????????????????????????????????????????????????? */}
          {/* SECTION 3: Unified Award + Metrics + Clients Card              */}
          {/* ???????????????????????????????????????????????????????????? */}
          <section className="py-20 md:pt-12 md:pb-32 relative z-10">
            <div className="max-w-7xl mx-auto px-4 md:px-6">
              <AwardMetricsUnified />
            </div>
          </section>

          {/* ???????????????????????????????????????????????????????????? */}
          {/* SECTION 4: SERVICES - Alternating Layout                      */}
          {/* ???????????????????????????????????????????????????????????? */}
          <ServicesAlternate />

        {/* ???????????????????????????????????????????????????????????? */}
        {/* SECTION 4: PHILOSOPHY - How We Work (Simple List)             */}
        {/* ???????????????????????????????????????????????????????????? */}
        <PhilosophyList />

        {/* ???????????????????????????????????????????????????????????? */}
        {/* SECTION 5: CEO - Expert Leadership                            */}
        {/* ???????????????????????????????????????????????????????????? */}
        <CEOSection />

        {/* ???????????????????????????????????????????????????????????? */}
        {/* SECTION 6: INSIGHTS - Thought Leadership                      */}
        {/* ???????????????????????????????????????????????????????????? */}
        <InsightsSection posts={posts} />

        {/* ???????????????????????????????????????????????????????????? */}
        {/* SECTION 7: FAQ - Objection Handling (Minimalist Accordion)    */}
        {/* ???????????????????????????????????????????????????????????? */}
        <FAQSection />

        {/* ???????????????????????????????????????????????????????????? */}
        {/* SECTION 8: CONTACT - Conversion (Split Panel)                 */}
        {/* ???????????????????????????????????????????????????????????? */}
        <CTASection />
        </div>
      </main>
    </>
  );
}
