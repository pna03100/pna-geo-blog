# ⚙️ 환경 변수 설정 가이드 (CORS 문제 해결)

## 🎯 문제 원인

Next.js 프로젝트의 환경 변수가 잘못 설정되어 있을 수 있습니다.

---

## ✅ 올바른 설정

### .env.local 파일 생성/수정

프로젝트 루트 폴더에 `.env.local` 파일을 만들고:

```bash
# ===============================================
# CORS 문제 해결 - 도메인 통일
# ===============================================

# WordPress GraphQL API
# ⚠️ 반드시 cms.pnamarketing.co.kr 사용!
WORDPRESS_API_URL=https://cms.pnamarketing.co.kr/graphql

# 재검증 비밀 토큰
WORDPRESS_REVALIDATE_SECRET=your-secret-token-here

# 프론트엔드 사이트 URL
NEXT_PUBLIC_SITE_URL=https://pnamarketing.co.kr

# WordPress CMS URL (iframe 등에서 사용)
NEXT_PUBLIC_WORDPRESS_URL=https://cms.pnamarketing.co.kr
```

---

## 🔧 코드 수정

### 1. components/ElementorIframe.tsx

도메인을 cms.pnamarketing.co.kr로 통일:

```typescript
export default function ElementorIframe({ 
  postId, 
  wpUrl = 'https://cms.pnamarketing.co.kr'  // 여기 수정!
}: Props) {
```

### 2. lib/api.ts (이미 올바름)

```typescript
const WORDPRESS_API_URL = process.env.WORDPRESS_API_URL || '';
// 환경 변수가 https://cms.pnamarketing.co.kr/graphql로 설정되어야 함
```

---

## 🚀 적용 방법

### 로컬 개발 환경:

```bash
# 1. .env.local 파일 수정
# 2. 개발 서버 재시작
npm run dev
```

### Vercel 배포 환경:

1. **Vercel 대시보드 접속**
2. **프로젝트 선택 → Settings → Environment Variables**
3. **다음 변수 추가/수정:**

```
Name: WORDPRESS_API_URL
Value: https://cms.pnamarketing.co.kr/graphql

Name: WORDPRESS_REVALIDATE_SECRET
Value: (랜덤 문자열)

Name: NEXT_PUBLIC_SITE_URL
Value: https://pnamarketing.co.kr

Name: NEXT_PUBLIC_WORDPRESS_URL
Value: https://cms.pnamarketing.co.kr
```

4. **Redeploy 클릭**

---

## ✅ 확인 방법

환경 변수가 올바르게 설정되었는지 확인:

```bash
# 터미널에서
npm run dev

# 브라우저에서
http://localhost:3000

# 개발자 도구(F12) → Console에서
console.log(process.env.WORDPRESS_API_URL)
```

---

## 🎯 최종 체크리스트

- [ ] WordPress 설정에서 도메인을 cms로 통일
- [ ] wp-config.php에 도메인 강제 설정 추가
- [ ] Code Snippets에 CORS 헤더 추가
- [ ] .env.local에서 WORDPRESS_API_URL을 cms로 설정
- [ ] components/ElementorIframe.tsx의 기본 URL을 cms로 변경
- [ ] 브라우저 캐시 삭제
- [ ] npm run dev 재시작
- [ ] WordPress Elementor 편집기 테스트

모두 완료하면 CORS 에러가 사라집니다! 🎉








