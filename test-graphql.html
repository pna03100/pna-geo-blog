<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress GraphQL API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #0070f3;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #0070f3;
            border-radius: 4px;
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #0051cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            color: #856404;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .api-url {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” WordPress GraphQL API ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        
        <div class="api-url">
            ğŸ“ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ: <code>https://cms.pnamarketing.co.kr/graphql</code>
        </div>

        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ì—°ê²° í™•ì¸</h2>
            <p>WordPress ì¼ë°˜ ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ APIê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testBasicConnection()">ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="result1"></div>
        </div>

        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ 2: í™ˆí˜ì´ì§€ ì¡°íšŒ (/home)</h2>
            <p>WordPressì˜ <code>/home</code> í˜ì´ì§€ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testHomePage()">í™ˆí˜ì´ì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="result2"></div>
        </div>

        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ 3: ëª¨ë“  í˜ì´ì§€ ëª©ë¡</h2>
            <p>WordPressì— ì–´ë–¤ í˜ì´ì§€ë“¤ì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testAllPages()">í˜ì´ì§€ ëª©ë¡ ì¡°íšŒ</button>
            <div id="result3"></div>
        </div>

        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ 4: ë©”ì¸ í˜ì´ì§€ ì„¤ì • í™•ì¸</h2>
            <p>WordPressì—ì„œ ë©”ì¸ í˜ì´ì§€ë¡œ ì„¤ì •ëœ í˜ì´ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testFrontPage()">ë©”ì¸ í˜ì´ì§€ í™•ì¸</button>
            <div id="result4"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ì¢…í•© ì§„ë‹¨</h2>
            <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="resultAll"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://cms.pnamarketing.co.kr/graphql';

        async function fetchGraphQL(query, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            resultElement.innerHTML = '<div class="result loading">â³ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            
            const startTime = Date.now();
            
            try {
                console.log('GraphQL ìš”ì²­ ì‹œì‘:', API_URL);
                console.log('Query:', query);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query }),
                });
                
                const elapsed = Date.now() - startTime;
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                console.log('ì‘ë‹µ ì‹œê°„:', elapsed + 'ms');
                
                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`HTTP ${response.status}: ${text.substring(0, 200)}`);
                }
                
                const data = await response.json();
                
                if (data.errors) {
                    resultElement.innerHTML = `<div class="result error">âŒ GraphQL ì—ëŸ¬ ë°œìƒ!\n\n${JSON.stringify(data.errors, null, 2)}</div>`;
                    return false;
                }
                
                resultElement.innerHTML = `<div class="result success">âœ… ì„±ê³µ! (ì‘ë‹µ ì‹œê°„: ${elapsed}ms)\n\n${JSON.stringify(data, null, 2)}</div>`;
                return true;
                
            } catch (error) {
                const elapsed = Date.now() - startTime;
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                resultElement.innerHTML = `<div class="result error">âŒ ì—°ê²° ì‹¤íŒ¨! (${elapsed}ms)\n\nì—ëŸ¬: ${error.message}\n\nê°€ëŠ¥í•œ ì›ì¸:\n1. WordPress ì„œë²„ê°€ ë‹¤ìš´ë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ ë¶ˆê°€\n2. CORS ì„¤ì • ë¬¸ì œ (ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸)\n3. WPGraphQL í”ŒëŸ¬ê·¸ì¸ì´ ë¹„í™œì„±í™”ë¨\n4. URLì´ ì˜ëª»ë˜ì—ˆìŒ</div>`;
                return false;
            }
        }

        async function testBasicConnection() {
            const query = `
                query TestConnection {
                    generalSettings {
                        title
                        url
                        description
                    }
                }
            `;
            await fetchGraphQL(query, 'result1');
        }

        async function testHomePage() {
            const query = `
                query GetHomePage {
                    contentNode(id: "/home", idType: URI) {
                        __typename
                        uri
                        ... on Page {
                            title
                            content
                            slug
                        }
                    }
                }
            `;
            await fetchGraphQL(query, 'result2');
        }

        async function testAllPages() {
            const query = `
                query GetAllPages {
                    pages(first: 50, where: { status: PUBLISH }) {
                        nodes {
                            id
                            title
                            uri
                            slug
                        }
                    }
                }
            `;
            await fetchGraphQL(query, 'result3');
        }

        async function testFrontPage() {
            const query = `
                query GetFrontPage {
                    generalSettings {
                        title
                        url
                    }
                    page(id: "front-page", idType: URI) {
                        title
                        uri
                        slug
                    }
                }
            `;
            await fetchGraphQL(query, 'result4');
        }

        async function runAllTests() {
            const resultElement = document.getElementById('resultAll');
            resultElement.innerHTML = '<div class="result loading">â³ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            
            const results = [];
            
            // í…ŒìŠ¤íŠ¸ 1
            const test1 = await testBasicConnection();
            results.push(`1. ê¸°ë³¸ ì—°ê²°: ${test1 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}`);
            
            await new Promise(r => setTimeout(r, 500));
            
            // í…ŒìŠ¤íŠ¸ 2
            const test2 = await testHomePage();
            results.push(`2. í™ˆí˜ì´ì§€ ì¡°íšŒ: ${test2 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}`);
            
            await new Promise(r => setTimeout(r, 500));
            
            // í…ŒìŠ¤íŠ¸ 3
            const test3 = await testAllPages();
            results.push(`3. í˜ì´ì§€ ëª©ë¡: ${test3 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}`);
            
            await new Promise(r => setTimeout(r, 500));
            
            // í…ŒìŠ¤íŠ¸ 4
            const test4 = await testFrontPage();
            results.push(`4. ë©”ì¸ í˜ì´ì§€: ${test4 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}`);
            
            let summary = results.join('\n');
            
            if (!test1) {
                summary += '\n\nâš ï¸ ê¶Œì¥ ì¡°ì¹˜:\n1. WordPress ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ WPGraphQL í”ŒëŸ¬ê·¸ì¸ í™•ì¸\n2. https://cms.pnamarketing.co.kr/graphql ë¸Œë¼ìš°ì €ë¡œ ì§ì ‘ ì ‘ì†\n3. WordPress ì„œë²„ ìƒíƒœ í™•ì¸';
            } else if (!test2 && test3) {
                summary += '\n\nâš ï¸ ê¶Œì¥ ì¡°ì¹˜:\n"/home" ìŠ¬ëŸ¬ê·¸ë¥¼ ê°€ì§„ í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.\nìœ„ì˜ "í…ŒìŠ¤íŠ¸ 3" ê²°ê³¼ì—ì„œ ì‹¤ì œ í˜ì´ì§€ ëª©ë¡ì„ í™•ì¸í•˜ê³ ,\ní•´ë‹¹ URIë¥¼ ì‚¬ìš©í•˜ë„ë¡ Next.js ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.';
            } else if (test1 && test2) {
                summary += '\n\nğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!\nNext.js ì•±ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.';
            }
            
            const cssClass = !test1 ? 'error' : (!test2 ? 'info' : 'success');
            resultElement.innerHTML = `<div class="result ${cssClass}">${summary}</div>`;
        }
    </script>
</body>
</html>

