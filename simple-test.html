<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„ë‹¨í•œ GraphQL í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background: #0051cc;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            text-align: center;
            font-size: 16px;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” WordPress GraphQL ê°„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="status" id="corsStatus">
            Chrome CORS í™•ì¥ í”„ë¡œê·¸ë¨ ìƒíƒœ: <strong>í™•ì¸ ì¤‘...</strong>
        </div>

        <button onclick="testConnection()">GraphQL ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        
        <div id="result"></div>
    </div>

    <script>
        const API_URL = 'https://cms.pnamarketing.co.kr/graphql';

        // CORS í™•ì¥ í”„ë¡œê·¸ë¨ ìƒíƒœ í™•ì¸
        window.addEventListener('load', function() {
            const corsStatus = document.getElementById('corsStatus');
            corsStatus.innerHTML = 'Chrome CORS í™•ì¥ í”„ë¡œê·¸ë¨: <strong style="color: orange;">í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì„¤ì¹˜ë˜ì–´ ìˆê³  ì´ˆë¡ìƒ‰ì¸ì§€ í™•ì¸í•˜ì„¸ìš”!</strong>';
        });

        async function testConnection() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'info';
            resultDiv.textContent = 'â³ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...\n\n' + 
                                    'ìš”ì²­ URL: ' + API_URL + '\n' +
                                    'ì‹œê°„: ' + new Date().toLocaleTimeString();

            const query = `
                query TestConnection {
                    generalSettings {
                        title
                        url
                        description
                    }
                }
            `;

            console.log('ğŸš€ GraphQL ìš”ì²­ ì‹œì‘');
            console.log('ğŸ“ URL:', API_URL);
            console.log('ğŸ“ Query:', query);

            try {
                const startTime = Date.now();

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });

                const elapsed = Date.now() - startTime;

                console.log('âœ… ì‘ë‹µ ë°›ìŒ:', response.status);
                console.log('â±ï¸ ì‘ë‹µ ì‹œê°„:', elapsed + 'ms');

                // ì‘ë‹µ í—¤ë” í™•ì¸
                const corsHeader = response.headers.get('Access-Control-Allow-Origin');
                console.log('ğŸ” CORS í—¤ë”:', corsHeader);

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`HTTP ${response.status}: ${text.substring(0, 200)}`);
                }

                const data = await response.json();

                if (data.errors) {
                    resultDiv.className = 'error';
                    resultDiv.textContent = 'âŒ GraphQL ì—ëŸ¬ ë°œìƒ!\n\n' +
                                          'ì—ëŸ¬: ' + JSON.stringify(data.errors, null, 2) + '\n\n' +
                                          'âš ï¸ ì›ì¸:\n' +
                                          '1. WPGraphQL í”ŒëŸ¬ê·¸ì¸ì´ ë¹„í™œì„±í™”ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤\n' +
                                          '2. GraphQL ì¿¼ë¦¬ ë¬¸ë²• ì˜¤ë¥˜\n' +
                                          '3. WordPress ì„œë²„ ë¬¸ì œ';
                    console.error('âŒ GraphQL ì—ëŸ¬:', data.errors);
                    return;
                }

                resultDiv.className = 'success';
                resultDiv.textContent = 'âœ…âœ…âœ… ì—°ê²° ì„±ê³µ! âœ…âœ…âœ…\n\n' +
                                      'ì‘ë‹µ ì‹œê°„: ' + elapsed + 'ms\n' +
                                      'CORS í—¤ë”: ' + (corsHeader || 'ì—†ìŒ') + '\n\n' +
                                      'ë°›ì€ ë°ì´í„°:\n' +
                                      JSON.stringify(data, null, 2) + '\n\n' +
                                      'ğŸ‰ WordPress GraphQL APIê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!';

                console.log('âœ…âœ…âœ… ì„±ê³µ! ë°ì´í„°:', data);

            } catch (error) {
                resultDiv.className = 'error';
                
                let errorMessage = 'âŒ ì—°ê²° ì‹¤íŒ¨!\n\n';
                errorMessage += 'ì—ëŸ¬ íƒ€ì…: ' + error.name + '\n';
                errorMessage += 'ì—ëŸ¬ ë©”ì‹œì§€: ' + error.message + '\n\n';

                if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'âš ï¸ ê°€ëŠ¥í•œ ì›ì¸:\n\n';
                    errorMessage += '1. CORS ì—ëŸ¬ (ê°€ì¥ ê°€ëŠ¥ì„± ë†’ìŒ)\n';
                    errorMessage += '   â†’ Chrome CORS í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì´ˆë¡ìƒ‰ì¸ì§€ í™•ì¸!\n';
                    errorMessage += '   â†’ WordPressì— WP CORS í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í™•ì¸\n\n';
                    errorMessage += '2. WordPress ì„œë²„ê°€ ë‹¤ìš´ë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ ë¶ˆê°€\n';
                    errorMessage += '   â†’ https://cms.pnamarketing.co.kr/graphql ë¸Œë¼ìš°ì €ë¡œ ì§ì ‘ ì ‘ì†í•´ë³´ì„¸ìš”\n\n';
                    errorMessage += '3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ\n';
                    errorMessage += '   â†’ ì¸í„°ë„· ì—°ê²° í™•ì¸\n\n';
                    errorMessage += 'ğŸ“Œ ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ ì—´ì–´ì„œ ë” ìì„¸í•œ ì—ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”!';
                } else if (error.message.includes('CORS')) {
                    errorMessage += 'âš ï¸ CORS ì •ì±… ì°¨ë‹¨!\n\n';
                    errorMessage += 'í•´ê²° ë°©ë²•:\n';
                    errorMessage += '1. Chrome CORS í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì¼œì„¸ìš” (ì´ˆë¡ìƒ‰)\n';
                    errorMessage += '2. WordPressì— WP CORS í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì„¸ìš”\n';
                    errorMessage += '3. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì„¸ìš” (Ctrl+Shift+Delete)';
                } else {
                    errorMessage += 'âš ï¸ ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ì…ë‹ˆë‹¤.\n';
                    errorMessage += 'ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                }

                resultDiv.textContent = errorMessage;
                console.error('âŒ ì—ëŸ¬ ë°œìƒ:', error);
                console.error('ìŠ¤íƒ:', error.stack);
            }
        }

        // ìë™ìœ¼ë¡œ í•œ ë²ˆ ì‹¤í–‰
        window.addEventListener('load', function() {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>

