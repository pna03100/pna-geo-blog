# 🚨 API 연결 실패 - 긴급 해결 가이드

## 📊 현재 상황
- **사이트:** https://pnamarketing.co.kr/
- **증상:** "임시 게시글 (API 연결 실패)" 메시지 표시
- **의미:** Next.js 앱은 작동하지만, WordPress GraphQL API 연결이 실패하고 있음

---

## 🔍 단계별 진단 및 해결 방법

### ✅ 1단계: WordPress GraphQL API 직접 테스트 (최우선!)

#### 방법 1: 브라우저에서 테스트
프로젝트 폴더의 **`test-graphql.html`** 파일을 브라우저로 열어서:
1. 파일 탐색기에서 `test-graphql.html` 우클릭
2. "연결 프로그램" → "Chrome" 또는 "Edge" 선택
3. "모든 테스트 실행" 버튼 클릭
4. 결과 확인

**기대 결과:**
- ✅ **모든 테스트 통과** → WordPress API 정상 (다음 단계로)
- ❌ **테스트 1 실패** → WordPress API 자체 문제 (아래 "WordPress API 문제" 섹션 참조)
- ⚠️ **테스트 2 실패 (홈페이지)** → `/home` 페이지 없음 (아래 "홈페이지 문제" 섹션 참조)

#### 방법 2: 브라우저에서 직접 접속
1. 브라우저에서 https://cms.pnamarketing.co.kr/graphql 접속
2. **GraphiQL IDE**가 나타나야 정상 (WPGraphQL이 설치되어 있음)
3. 404 에러 → WPGraphQL 플러그인이 비활성화되었거나 설치되지 않음

---

### ✅ 2단계: Vercel 환경 변수 확인 (배포 환경)

현재 https://pnamarketing.co.kr 는 Vercel에 배포된 것으로 보입니다.

#### Vercel 대시보드에서 확인:
1. https://vercel.com 로그인
2. 프로젝트 선택
3. **Settings** → **Environment Variables** 클릭

#### 필수 환경 변수 확인:

```
Name: WORDPRESS_API_URL
Value: https://cms.pnamarketing.co.kr/graphql  ⬅️ 반드시 CMS 도메인!
Environments: ✅ Production ✅ Preview ✅ Development
```

**주의:** `https://pnamarketing.co.kr/graphql` ❌ (잘못된 도메인!)
**정답:** `https://cms.pnamarketing.co.kr/graphql` ✅

#### 환경 변수 수정 후:
1. **Deployments** 탭으로 이동
2. 최근 배포에서 **⋯** 클릭 → **Redeploy** 선택
3. 재배포 완료 후 사이트 새로고침

---

### ✅ 3단계: WordPress /home 페이지 존재 확인

#### WordPress 관리자에서 확인:
1. https://cms.pnamarketing.co.kr/wp-admin 로그인
2. **페이지** → **모든 페이지** 클릭
3. 슬러그(URL)가 **`home`** 인 페이지가 있는지 확인
4. 해당 페이지가 **"게시됨"** 상태인지 확인

#### 페이지가 없는 경우:

**옵션 A: /home 페이지 생성**
1. WordPress 관리자 → **페이지** → **새로 추가**
2. 제목: "홈" 입력
3. 오른쪽 **"고유주소"** 섹션에서 슬러그를 **`home`** 으로 설정
4. **게시** 버튼 클릭

**옵션 B: Next.js 코드 수정 (다른 페이지 사용)**

`test-graphql.html`에서 "테스트 3: 모든 페이지 목록"을 실행하여 실제 페이지 목록을 확인한 후:

`app/page.tsx` 파일 수정:
```typescript
// 60번째 줄 근처
// 기존:
content = await getContentByURI('/home');

// 변경 (예: 실제 존재하는 페이지 URI 사용):
content = await getContentByURI('/'); // 또는 다른 실제 페이지 URI
```

---

### ✅ 4단계: CORS 설정 확인 (WordPress)

WordPress에서 CORS를 허용해야 Next.js가 API에 접근할 수 있습니다.

#### WordPress `wp-config.php` 파일에 추가:
```php
// CORS 허용 (파일 맨 위에 추가, <?php 태그 다음)
header('Access-Control-Allow-Origin: https://pnamarketing.co.kr');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');
```

**또는** WordPress 플러그인 사용:
1. **"WPGraphQL CORS"** 플러그인 설치
2. 설정에서 허용 도메인에 `https://pnamarketing.co.kr` 추가

---

### ✅ 5단계: WPGraphQL 플러그인 확인

#### WordPress 관리자에서:
1. **플러그인** → **설치된 플러그인** 클릭
2. **WPGraphQL** 플러그인 찾기
3. **"활성"** 상태인지 확인
4. 비활성화되어 있다면 → **활성화** 클릭

#### 추가 플러그인 (SEO 사용 시):
- **WPGraphQL for Rank Math** (Rank Math SEO 사용 시)
- **WPGraphQL for Yoast SEO** (Yoast SEO 사용 시)

---

## 🎯 가장 가능성 높은 원인 Top 3

### 1️⃣ Vercel 환경 변수 잘못됨 (70% 확률)
**증상:** 로컬에서는 작동하지만 배포된 사이트에서는 실패
**해결:** Vercel 대시보드에서 환경 변수 확인 및 수정 → 재배포

### 2️⃣ WordPress /home 페이지 없음 (20% 확률)
**증상:** test-graphql.html에서 "테스트 2" 실패
**해결:** WordPress에서 /home 페이지 생성 또는 Next.js 코드 수정

### 3️⃣ WPGraphQL 플러그인 비활성화 (10% 확률)
**증상:** https://cms.pnamarketing.co.kr/graphql 접속 시 404
**해결:** WordPress 관리자에서 WPGraphQL 플러그인 활성화

---

## 🔧 로컬 개발 환경 확인

로컬에서도 테스트하려면:

### 1. 환경 변수 확인
`.env.local` 파일 내용:
```env
WORDPRESS_API_URL=https://cms.pnamarketing.co.kr/graphql
```

### 2. 개발 서버 실행
```powershell
cd "프로젝트 폴더 경로"
npm run dev
```

### 3. 브라우저에서 확인
http://localhost:3000 접속

### 4. 콘솔 로그 확인
터미널에 다음과 같은 로그가 출력되어야 합니다:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 [API 요청 시작]
📍 URL: https://cms.pnamarketing.co.kr/graphql
📝 Query: ...
✅ 응답 상태: 200 OK
✅ 데이터 수신 성공
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**에러가 보이면:** 에러 메시지를 확인하여 정확한 원인 파악

---

## 📞 추가 지원이 필요한 경우

위 단계를 모두 시도했는데도 해결되지 않는다면, 다음 정보를 제공해주세요:

1. `test-graphql.html` 실행 결과 스크린샷
2. Vercel 환경 변수 스크린샷 (값은 가려도 됨)
3. https://cms.pnamarketing.co.kr/graphql 접속 스크린샷
4. WordPress 플러그인 목록 스크린샷

---

## ✅ 해결 체크리스트

- [ ] `test-graphql.html` 실행하여 API 연결 테스트
- [ ] Vercel 환경 변수 `WORDPRESS_API_URL` 확인
- [ ] WordPress /home 페이지 존재 여부 확인
- [ ] WPGraphQL 플러그인 활성화 확인
- [ ] CORS 설정 확인
- [ ] Vercel 재배포 실행
- [ ] 배포 후 https://pnamarketing.co.kr 새로고침

---

**파일 변경 사항 요약:**
- ✅ `.env.local` - 환경 변수 수정 완료
- ✅ `next.config.js` - Rewrites 설정 수정 완료 (Headless 모드)
- ✅ `app/page.tsx` - 홈페이지 라우트 생성 완료
- ✅ `test-graphql.html` - API 테스트 도구 생성 완료

**다음 단계:**
1. `test-graphql.html` 실행하여 WordPress API 상태 확인
2. Vercel 환경 변수 점검 및 재배포
3. 결과 확인 후 추가 조치

